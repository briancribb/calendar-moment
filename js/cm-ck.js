var CM={init:function(settings){"use strict";CM.events=settings.events;CM.$targetCalendar=settings.$targetCalendar;var targetMoment=settings.targetMoment;console.log("CM.events:");console.log(CM.events);console.log(" ");CM.$targetCalendar.on("click",".cm_nav button",function(event){if($(this).hasClass("cm_prev")){targetMoment.month(targetMoment.month()-1)}else if($(this).hasClass("cm_next")){targetMoment.month(targetMoment.month()+1)}else if($(this).hasClass("cm_now")){targetMoment=moment()}CM.build(targetMoment)});CM.build(targetMoment)},build:function(targetMoment){"use strict";function buildEvent(currentMomentInt){var eventString="",eventClass="",eventIndex=0,buildEventMarkup=function(index,classToAdd){eventIndex=index;eventClass=classToAdd;return"<!-- Event Markup -->"};for(var j=0;j<CM.events.length;j++){var eventStartInt=parseInt(moment(CM.events[j].startTime).format("YYYYMMDD")),eventEndInt=parseInt(moment(CM.events[j].endTime).format("YYYYMMDD"));if(currentMomentInt===eventStartInt){eventString=buildEventMarkup(j," cm_event--start")}else if(currentMomentInt===eventEndInt){eventString=buildEventMarkup(j," cm_event--end")}else if(currentMomentInt>eventStartInt&&currentMomentInt<eventEndInt){eventString=buildEventMarkup(j," cm_event--middle")}}return{eventString:eventString,eventClass:eventClass,eventIndex:eventIndex}}function initBuild(){var rightNow=moment(),$btnPrev=CM.$targetCalendar.find("#cm_nav .cm_prev"),$btnNow=CM.$targetCalendar.find("#cm_nav .cm_now"),$btnNext=CM.$targetCalendar.find("#cm_nav .cm_next");if(targetMoment.month()===rightNow.month()){$btnPrev.prop("disabled",true).addClass("alt");$btnNow.prop("disabled",true).addClass("alt");$btnNext.prop("disabled",false).removeClass("alt")}else if(moment(targetMoment).isBefore(rightNow)){$btnPrev.prop("disabled",true).addClass("alt");$btnNow.prop("disabled",false).removeClass("alt");$btnNext.prop("disabled",false).removeClass("alt")}else if(moment(targetMoment).isAfter(rightNow)){$btnPrev.prop("disabled",false).removeClass("alt");$btnNow.prop("disabled",false).removeClass("alt");$btnNext.prop("disabled",false).removeClass("alt")}CM.$dayCells=CM.$targetCalendar.find(".cm_day");CM.$eventCells=CM.$targetCalendar.find(".cm_event")}var currentMoment=targetMoment.clone(),headerString='<header class="cm_header"><div class="cm_title">'+targetMoment.format("MMMM, YYYY")+'</div><nav id="cm_nav" class="cm_nav"><button class="cm_prev button" disabled><< Prev</button><button class="cm_now button" disabled>Now</button><button class="cm_next button" disabled>Next >></button></nav></header>',openingString='<section class="cm_body">',weekdayString='<ul class="cm_weekdays"><li>Sunday</li><li>Monday</li><li>Tuesday</li><li>Wednesday</li><li>Thursday</li><li>Friday</li><li>Saturday</li></ul>',weeksString='<ul class="cm_week">',closingString="</section>";var calendarString=headerString+openingString+weekdayString+weeksString,dayString="",thisMonth=currentMoment.month(),daysInThisMonth=currentMoment.daysInMonth(),lastWeekdayNum=currentMoment.date(currentMoment.daysInMonth()).weekday(),firstWeekdayNum=currentMoment.date(1).weekday(),beforeMonth=false,afterMonth=false;var dayCounter=1-firstWeekdayNum,lastDay=6-lastWeekdayNum+daysInThisMonth,totalDays=lastDay+firstWeekdayNum;currentMoment.date(dayCounter);for(var i=0;i<totalDays;i++){var extraClasses="",dataAttr="",calendarEvent=buildEvent(parseInt(currentMoment.format("YYYYMMDD")));beforeMonth=dayCounter<1?true:false;afterMonth=dayCounter>daysInThisMonth?true:false;if(beforeMonth||afterMonth){extraClasses+=" out_of_range"}if(calendarEvent.eventString===""){extraClasses+=" no_event"}else{extraClasses+=calendarEvent.eventClass;dataAttr+=' data-event-index="'+calendarEvent.eventIndex+'"'}var eventSpanString=CM.events[calendarEvent.eventIndex].momentStart.format("Do")+" - "+CM.events[calendarEvent.eventIndex].momentEnd.format("Do");var dayString='<li class="cm_day'+extraClasses+'"'+dataAttr+">"+'<div class="cm_day-cell">'+'<div class="cm_date-title">'+'<span class="cm_date">'+currentMoment.format("Do")+"</span>"+"</div>"+calendarEvent.eventString+"</div>"+"</li>";if((i+1)%7===0&&dayCounter<daysInThisMonth){dayString+='</ul><ul class="cm_week">'}dayCounter++;calendarString+=dayString;currentMoment.add("days",1)}calendarString+="</ul>"+closingString;CM.$targetCalendar.addClass("cm").html(calendarString).find(".cm_body").addClass("justAddedThis");return initBuild()},equalHeight:function(clearValue){"use strict";function checkHeight($target){var thisHeight=$target.height();if(thisHeight>tallest){tallest=thisHeight}}var tallest=0;if(clearValue){CM.$dayCells.removeAttr("height");CM.$eventCells.removeAttr("height")}CM.$dayCells.each(function(){checkHeight($(this))}).css("min-height",tallest);tallest=0;CM.$eventCells.each(function(){checkHeight($(this))}).css("min-height",tallest)}};