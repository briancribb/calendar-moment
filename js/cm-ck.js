var CM={init:function(settings){"use strict";CM.events=settings.events;CM.$targetCalendar=settings.$targetCalendar;var targetMoment=settings.targetMoment;CM.$targetCalendar.on("click",".cm_nav button",function(event){if($(this).hasClass("cm_prev")){targetMoment.month(targetMoment.month()-1)}else if($(this).hasClass("cm_next")){targetMoment.month(targetMoment.month()+1)}else if($(this).hasClass("cm_now")){targetMoment=moment()}CM.build(targetMoment)});CM.build(targetMoment)},build:function(targetMoment){"use strict";function buildEvents(currentMomentInt){var eventString="",eventIndex=0,buildEventMarkup=function(index,classToAdd){return'<div class="cm_event'+classToAdd+'" data-event-index="'+index+'">'+'<div class="cm_event__content">'+'<div class="cm_event__title">'+'<a class="cm_event__link" target="_blank" href="'+CM.events[index].url+'">'+CM.events[index].summary+"</a>"+"</div>"+"</div>"+"</div>"};for(var j=0;j<CM.events.length;j++){var eventStartInt=parseInt(moment(CM.events[j].startTime).format("YYYYMMDD"));if(currentMomentInt===eventStartInt){eventString+=buildEventMarkup(j,"")}}var hasEvent=eventString===""?false:true;return{hasEvent:hasEvent,eventString:eventString}}function initBuild(){var rightNow=moment(),$btnPrev=CM.$targetCalendar.find("#cm_nav .cm_prev"),$btnNow=CM.$targetCalendar.find("#cm_nav .cm_now"),$btnNext=CM.$targetCalendar.find("#cm_nav .cm_next");if(targetMoment.month()===rightNow.month()){$btnPrev.prop("disabled",true).addClass("alt");$btnNow.prop("disabled",true).addClass("alt");$btnNext.prop("disabled",false).removeClass("alt")}else if(moment(targetMoment).isBefore(rightNow)){$btnPrev.prop("disabled",true).addClass("alt");$btnNow.prop("disabled",false).removeClass("alt");$btnNext.prop("disabled",false).removeClass("alt")}else if(moment(targetMoment).isAfter(rightNow)){$btnPrev.prop("disabled",false).removeClass("alt");$btnNow.prop("disabled",false).removeClass("alt");$btnNext.prop("disabled",false).removeClass("alt")}CM.$dayCells=CM.$targetCalendar.find(".cm_day");CM.$eventCells=CM.$targetCalendar.find(".cm_event");CM.update()}var currentMoment=targetMoment.clone(),headerString='<header class="cm_header"><div class="cm_title">'+targetMoment.format("MMMM, YYYY")+'</div><nav id="cm_nav" class="cm_nav"><button class="cm_prev button" disabled><< Prev</button><button class="cm_now button" disabled>Now</button><button class="cm_next button" disabled>Next >></button></nav></header>',openingString='<section class="cm_body">',weekdayString='<ul class="cm_weekdays"><li>Sunday</li><li>Monday</li><li>Tuesday</li><li>Wednesday</li><li>Thursday</li><li>Friday</li><li>Saturday</li></ul>',weeksString='<ul class="cm_week">',closingString="</section>";var calendarString=headerString+openingString+weekdayString+weeksString,dayString="",thisMonth=currentMoment.month(),daysInThisMonth=currentMoment.daysInMonth(),lastWeekdayNum=currentMoment.date(currentMoment.daysInMonth()).weekday(),firstWeekdayNum=currentMoment.date(1).weekday();var dayCounter=1-firstWeekdayNum,lastDay=6-lastWeekdayNum+daysInThisMonth,totalDays=lastDay+firstWeekdayNum;currentMoment.date(dayCounter);for(var i=0;i<totalDays;i++){var extraClasses="",calendarEvent=buildEvents(parseInt(currentMoment.format("YYYYMMDD")));if(dayCounter<1||dayCounter>daysInThisMonth){extraClasses+=" out_of_range"}extraClasses+=calendarEvent.hasEvent===true?" has_event":" no_event";var dayString='<li class="cm_day'+extraClasses+'">'+'<div class="cm_day-cell">'+'<div class="cm_date">'+'<span class="cm_date--title">'+currentMoment.format("dddd")+", "+currentMoment.format("MMM")+" "+currentMoment.format("Do")+"</span>"+'<span class="cm_date--int">'+currentMoment.format("D")+"</span>"+"</div>"+calendarEvent.eventString+"</div>"+"</li>";if((i+1)%7===0&&dayCounter<daysInThisMonth){dayString+='</ul><ul class="cm_week">'}dayCounter++;calendarString+=dayString;currentMoment.add(1,"days")}calendarString+="</ul>"+closingString;CM.$targetCalendar.addClass("cm").html(calendarString).find(".cm_body");return initBuild()},equalHeight:function(clearValue){"use strict";function checkHeight($target){var thisHeight=$target.height();if(thisHeight>tallest){tallest=thisHeight}}var tallest=0;if(clearValue){CM.$dayCells.removeAttr("height");CM.$eventCells.removeAttr("height")}else{CM.$dayCells.each(function(){checkHeight($(this));$(this).attr("data-num-events",$(this).find(".cm_event").length)}).css("min-height",tallest)}tallest=0},update:function(){if(!$(".cm_body .has_event").is(":visible")){CM.$targetCalendar.addClass("month_no_events")}else{CM.$targetCalendar.removeClass("month_no_events")}if($(".cm_body .has_event").is(":visible")){CM.equalHeight(true)}else{}}};